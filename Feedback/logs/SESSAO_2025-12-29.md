## [2025-12-29] - Sessão de Desenvolvimento

### 1. Correção de Tabelas Markdown (Artigos Educacionais)

**Problema:** Tabelas markdown renderizavam como texto cru (`|---|---|---|`) nos artigos de regulação.

**Causa Raiz:** Os componentes React (`ArtigoEducacionalClient.tsx`, `GuiaEssencialClient.tsx`) usavam `react-markdown` sem o plugin `remarkGfm`.

**Correções:**
- Adicionado `import remarkGfm from 'remark-gfm'` em ambos os componentes
- Adicionado `remarkPlugins={[remarkGfm]}` ao `<ReactMarkdown>`
- Criado estilos customizados para `table`, `thead`, `tbody`, `tr`, `th`, `td`

**Arquivos Modificados:**
- `app/educacao/[slug]/ArtigoEducacionalClient.tsx`
- `app/educacao/[slug]/GuiaEssencialClient.tsx`

---

### 2. Regeneração de Artigo Corrompido

**Problema:** Regex agressivo no `manual-fix-regulacao.ts` deletou 80% do conteúdo de `declarar-cripto-brasil`.

**Solução:**
- Criado `scripts/regenerate-declarar-cripto.ts`
- Regenerado artigo via Perplexity API (~$0.06)
- Novo artigo com 10 seções (vs 6 originais), 8.315 caracteres

**Commit:** `6c13867` - fix: add remarkGfm plugin for markdown tables

---

### 3. Externalização de Prompts Perplexity

**Objetivo:** Mover prompts hardcoded de `route.ts` para arquivos `.md` editáveis.

**Arquivos Criados:**
```
.agent/workflows/
├── criador-conteudo.md           # Documentação
└── prompts/
    ├── trends.md                 # Pesquisa de tendências
    ├── news.md                   # Notícias
    ├── educational.md            # Artigos educacionais
    └── resource.md               # Guias de recursos

lib/prompts/
└── prompt-loader.ts              # Loader com cache
```

**Resultado:**
- `route.ts`: 552 → 158 linhas (**71% redução**)
- Suporte a variável `{{CURRENT_TIME}}`
- Cache em memória (5min dev, 1h prod)

**Commit:** `96b3cd1` - refactor: externalize Perplexity prompts to .md files

---

### 4. Manutenção do Ecossistema de Agents

**Verificações (workflow /manutencao):**
- ✅ Todos os paths referenciados existem
- ✅ Estrutura `Feedback/` completa
- ✅ Frontmatter YAML em todos os arquivos
- ✅ Todos os workflows listados no `_INDEX.md`
- ⚠️ Última auditoria: 5 dias (2025-12-24)

**Atualização:**
- Adicionado `criador-conteudo.md` ao `_INDEX.md`

---

### 5. Backup do Banco de Dados

**Problema Inicial:** `pg_dump` não instalado.

**Instalações:**
1. `postgresql-client` (v16) - inicialmente
2. `postgresql-client-17` - necessário pois servidor Supabase é v17.6

**Backup Criado:**
```
/home/zenfoco/Documentos/Backup Supabase/Banco de dados - dia 29-12 - 22 horas.sql
Tamanho: 691KB
```

**Pendência:** Atualizar `scripts/db-backup.sh` para usar `/usr/lib/postgresql/17/bin/pg_dump`

---

### Resumo de Commits
| Hash | Descrição |
|------|-----------|
| `6c13867` | fix: add remarkGfm plugin for markdown tables + regenerate declarar-cripto-brasil |
| `96b3cd1` | refactor: externalize Perplexity prompts to .md files |

### Próxima Sessão
- [ ] Atualizar `db-backup.sh` para usar pg_dump v17
- [ ] Considerar nova auditoria (última há 5 dias)
